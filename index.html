<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
  .dashboard {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
  }
</style>

<script>
  let sortable;

  function initDragAndDrop() {
    const dashboard = document.getElementById('dashboard');
    if (sortable) sortable.destroy();
    sortable = new Sortable(dashboard, {
      animation: 150,
      onEnd: () => {
        const newOrder = Array.from(dashboard.children).map(card => parseInt(card.getAttribute('data-tool-id')));
        toolsData = newOrder.map(id => toolsData.find(t => t.id === id));
      }
    });
  }

  function renderDashboard() {
    const dashboard = document.getElementById('dashboard');
    dashboard.innerHTML = '';
    toolsData.forEach(tool => {
      const card = document.createElement('div');
      card.className = 'tool-card';
      card.setAttribute('data-tool-id', tool.id);

      const icon = document.createElement('div');
      icon.className = 'tool-icon';
      icon.style.backgroundColor = tool.color;
      icon.innerHTML = `<span class="material-icons">${tool.icon}</span>`;

      const title = document.createElement('div');
      title.className = 'tool-title';
      title.textContent = tool.title;

      const description = document.createElement('div');
      description.className = 'tool-description';
      description.textContent = tool.description;

      const editBtn = document.createElement('div');
      editBtn.className = 'edit-button';
      editBtn.innerHTML = '<span class="material-icons" style="font-size:16px;">edit</span>';
      editBtn.addEventListener('click', e => {
        e.stopPropagation();
        openEditModal(tool);
      });

      const deleteBtn = document.createElement('div');
      deleteBtn.className = 'delete-button';
      deleteBtn.innerHTML = '<span class="material-icons" style="font-size:16px;">delete</span>';
      deleteBtn.addEventListener('click', e => {
        e.stopPropagation();
        toolsData = toolsData.filter(t => t.id !== tool.id);
        renderDashboard();
      });

      card.appendChild(icon);
      card.appendChild(title);
      card.appendChild(description);
      card.appendChild(editBtn);
      card.appendChild(deleteBtn);

      card.addEventListener('click', () => {
        if (tool.url && tool.url !== '#') {
          window.open(tool.url, '_blank');
        }
      });

      dashboard.appendChild(card);
    });
    initDragAndDrop();
  }
</script>
